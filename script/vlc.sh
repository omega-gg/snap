#!/bin/sh
set -e

#--------------------------------------------------------------------------------------------------
# Settings
#--------------------------------------------------------------------------------------------------

deploy="../deploy"

VLC3_version="3.0.21"
VLC4_version="4.0.0"

snap3="https://api.snapcraft.io/api/v1/snaps/download/RT9mcUhVsRYrDLG8qnvGiy26NKvv6Qkd_3777.snap"
snap4="https://api.snapcraft.io/api/v1/snaps/download/RT9mcUhVsRYrDLG8qnvGiy26NKvv6Qkd_4070.snap"

#--------------------------------------------------------------------------------------------------
# Functions
#--------------------------------------------------------------------------------------------------

download()
{
    echo ""
    echo "DOWNLOADING $1"
    echo "$2"

    curl -L -o data.snap "$2"

    echo "EXTRACTING"

    unsquashfs -f -d data data.snap

    echo "DEPLOYING"

    mkdir -p $deploy/$1

    mv data/* $deploy/$1

    rm -rf data
}

#--------------------------------------------------------------------------------------------------
# Syntax
#--------------------------------------------------------------------------------------------------

if [ $# != 1 ] || [ $1 != "vlc3" -a $1 != "vlc4" ]; then

    echo "Usage: vlc <vlc3 | vlc4>"

    exit 1
fi

#--------------------------------------------------------------------------------------------------
# List
#--------------------------------------------------------------------------------------------------

echo ""
echo "LISTING"

curl -H 'Snap-Device-Series: 16' http://api.snapcraft.io/v2/snaps/info/vlc

#--------------------------------------------------------------------------------------------------
# Clean
#--------------------------------------------------------------------------------------------------

echo ""
echo "CLEANING"

rm -rf deploy/*

touch $deploy/.gitignore

#--------------------------------------------------------------------------------------------------
# Download
#--------------------------------------------------------------------------------------------------

if [ $1 = "vlc3" ]; then

    download $VLC3_version "$snap3"
else
    download $VLC4_version "$snap4"
fi
